/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
"use strict";var T=Object.create;var p=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var x=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),j=(o,e)=>{for(var t in e)p(o,t,{get:e[t],enumerable:!0})},C=(o,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of k(e))!$.call(o,i)&&i!==t&&p(o,i,{get:()=>e[i],enumerable:!(a=P(e,i))||a.enumerable});return o};var I=(o,e,t)=>(t=o!=null?T(N(o)):{},C(e||!o||!o.__esModule?p(t,"default",{value:o,enumerable:!0}):t,o)),L=o=>C(p({},"__esModule",{value:!0}),o);var F=x((ee,O)=>{O.exports={commands:{capture_email:"Capture Email",generate_daily_summary:"Generate Daily Summary",search_knowledge_base:"Search Knowledge Base",bulk_import_emails:"Bulk Import Emails"},ribbon:{capture_email:"Capture Email"},modal:{capture_email:{title:"Capture Email Inquiry",sender_email:"Sender Email",sender_name:"Sender Name",subject:"Subject",category:"Category",priority:"Priority",tags:"Tags",email_content:"Email Content",capture_button:"Capture Email",cancel_button:"Cancel",placeholder:{sender_email:"customer@example.com",sender_name:"John Customer (optional)",subject:"Login Issue - Cannot Access Dashboard",tags:"login-issue, dashboard, urgent",email_content:"Paste email content here..."},validation:{sender_email_required:"Sender email is required",sender_email_invalid:"Please enter a valid email address",subject_required:"Subject is required",content_required:"Email content is required"}}},categories:{specification:"Specification",issue:"Issue",migration_vup:"Migration/VUP",other:"Other"},priorities:{low:"Low",medium:"Medium",high:"High",urgent:"Urgent"},settings:{title:"Email Inquiry Management",folders:{title:"Folder Settings",emails_folder:"Emails Folder",summaries_folder:"Summaries Folder",knowledge_folder:"Knowledge Folder",emails_folder_desc:"Folder where captured emails will be stored",summaries_folder_desc:"Folder where daily summaries will be saved",knowledge_folder_desc:"Folder where extracted knowledge will be stored"},categories:{title:"Custom Categories",add_category:"Add Custom Category",add_category_desc:"Create a new category for email classification",add_button:"Add",category_placeholder:"Enter category name...",no_custom_categories:"No custom categories defined. Add categories to extend the default options.",manage_desc:"Click the \xD7 button to delete a category. This will not affect existing emails.",delete_confirm:"Are you sure you want to delete the category '{{category}}'? This action cannot be undone.",delete_tooltip:"Delete this category"},defaults:{title:"Default Values",category:"Default Category",priority:"Default Priority",category_desc:"Default category for new emails",priority_desc:"Default priority for new emails"},automation:{title:"Automation Settings",auto_summary:"Auto-generate Daily Summaries",auto_knowledge:"Auto-extract Knowledge",enable_notifications:"Enable Notifications",auto_summary_desc:"Automatically generate daily summaries",auto_knowledge_desc:"Automatically extract knowledge from resolved emails",enable_notifications_desc:"Show notifications for plugin actions"},advanced:{title:"Advanced Settings",max_attachment_size:"Max Attachment Size (MB)",language:"Language",max_attachment_size_desc:"Maximum file size for attachments",language_desc:"Plugin interface language"}},notices:{email_captured:"Email captured: {{path}}",generating_summary:"Generating daily summary for {{date}}...",summary_generated:"Daily summary generated successfully",error_generating_summary:"Error generating summary: {{error}}",knowledge_search_coming_soon:"Knowledge search coming soon...",bulk_import_coming_soon:"Bulk import coming soon...",settings_saved:"Settings saved successfully"},languages:{en:"English",ja:"\u65E5\u672C\u8A9E"}}});var A=x((te,q)=>{q.exports={commands:{capture_email:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3",generate_daily_summary:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u751F\u6210",search_knowledge_base:"\u77E5\u8B58\u30D9\u30FC\u30B9\u3092\u691C\u7D22",bulk_import_emails:"\u30E1\u30FC\u30EB\u306E\u4E00\u62EC\u30A4\u30F3\u30DD\u30FC\u30C8"},ribbon:{capture_email:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3"},modal:{capture_email:{title:"\u30E1\u30FC\u30EB\u554F\u3044\u5408\u308F\u305B\u3092\u30AD\u30E3\u30D7\u30C1\u30E3",sender_email:"\u9001\u4FE1\u8005\u30E1\u30FC\u30EB",sender_name:"\u9001\u4FE1\u8005\u540D",subject:"\u4EF6\u540D",category:"\u30AB\u30C6\u30B4\u30EA",priority:"\u512A\u5148\u5EA6",tags:"\u30BF\u30B0",email_content:"\u30E1\u30FC\u30EB\u5185\u5BB9",capture_button:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3",cancel_button:"\u30AD\u30E3\u30F3\u30BB\u30EB",placeholder:{sender_email:"customer@example.com",sender_name:"\u7530\u4E2D\u592A\u90CE\uFF08\u4EFB\u610F\uFF09",subject:"\u30ED\u30B0\u30A4\u30F3\u554F\u984C - \u30C0\u30C3\u30B7\u30E5\u30DC\u30FC\u30C9\u306B\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u307E\u305B\u3093",tags:"\u30ED\u30B0\u30A4\u30F3\u554F\u984C, \u30C0\u30C3\u30B7\u30E5\u30DC\u30FC\u30C9, \u7DCA\u6025",email_content:"\u30E1\u30FC\u30EB\u5185\u5BB9\u3092\u3053\u3053\u306B\u8CBC\u308A\u4ED8\u3051\u3066\u304F\u3060\u3055\u3044..."},validation:{sender_email_required:"\u9001\u4FE1\u8005\u30E1\u30FC\u30EB\u306F\u5FC5\u9808\u3067\u3059",sender_email_invalid:"\u6709\u52B9\u306A\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044",subject_required:"\u4EF6\u540D\u306F\u5FC5\u9808\u3067\u3059",content_required:"\u30E1\u30FC\u30EB\u5185\u5BB9\u306F\u5FC5\u9808\u3067\u3059"}}},categories:{specification:"\u4ED5\u69D8",issue:"\u969C\u5BB3",migration_vup:"\u79FB\u884C/VUP",other:"\u305D\u306E\u4ED6"},priorities:{low:"\u4F4E",medium:"\u4E2D",high:"\u9AD8",urgent:"\u7DCA\u6025"},settings:{title:"\u30E1\u30FC\u30EB\u554F\u3044\u5408\u308F\u305B\u7BA1\u7406",folders:{title:"\u30D5\u30A9\u30EB\u30C0\u8A2D\u5B9A",emails_folder:"\u30E1\u30FC\u30EB\u30D5\u30A9\u30EB\u30C0",summaries_folder:"\u30B5\u30DE\u30EA\u30FC\u30D5\u30A9\u30EB\u30C0",knowledge_folder:"\u30CA\u30EC\u30C3\u30B8\u30D5\u30A9\u30EB\u30C0",emails_folder_desc:"\u30AD\u30E3\u30D7\u30C1\u30E3\u3057\u305F\u30E1\u30FC\u30EB\u3092\u4FDD\u5B58\u3059\u308B\u30D5\u30A9\u30EB\u30C0",summaries_folder_desc:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u4FDD\u5B58\u3059\u308B\u30D5\u30A9\u30EB\u30C0",knowledge_folder_desc:"\u62BD\u51FA\u3057\u305F\u30CA\u30EC\u30C3\u30B8\u3092\u4FDD\u5B58\u3059\u308B\u30D5\u30A9\u30EB\u30C0"},categories:{title:"\u30AB\u30B9\u30BF\u30E0\u30AB\u30C6\u30B4\u30EA",add_category:"\u30AB\u30B9\u30BF\u30E0\u30AB\u30C6\u30B4\u30EA\u3092\u8FFD\u52A0",add_category_desc:"\u30E1\u30FC\u30EB\u5206\u985E\u7528\u306E\u65B0\u3057\u3044\u30AB\u30C6\u30B4\u30EA\u3092\u4F5C\u6210",add_button:"\u8FFD\u52A0",category_placeholder:"\u30AB\u30C6\u30B4\u30EA\u540D\u3092\u5165\u529B...",no_custom_categories:"\u30AB\u30B9\u30BF\u30E0\u30AB\u30C6\u30B4\u30EA\u304C\u5B9A\u7FA9\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002\u30C7\u30D5\u30A9\u30EB\u30C8\u30AA\u30D7\u30B7\u30E7\u30F3\u3092\u62E1\u5F35\u3059\u308B\u305F\u3081\u306B\u30AB\u30C6\u30B4\u30EA\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044\u3002",manage_desc:"\xD7\u30DC\u30BF\u30F3\u3092\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u30AB\u30C6\u30B4\u30EA\u3092\u524A\u9664\u3067\u304D\u307E\u3059\u3002\u65E2\u5B58\u306E\u30E1\u30FC\u30EB\u306B\u306F\u5F71\u97FF\u3057\u307E\u305B\u3093\u3002",delete_confirm:"\u30AB\u30C6\u30B4\u30EA '{{category}}' \u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F\u3053\u306E\u64CD\u4F5C\u306F\u5143\u306B\u623B\u305B\u307E\u305B\u3093\u3002",delete_tooltip:"\u3053\u306E\u30AB\u30C6\u30B4\u30EA\u3092\u524A\u9664"},defaults:{title:"\u30C7\u30D5\u30A9\u30EB\u30C8\u5024",category:"\u30C7\u30D5\u30A9\u30EB\u30C8\u30AB\u30C6\u30B4\u30EA",priority:"\u30C7\u30D5\u30A9\u30EB\u30C8\u512A\u5148\u5EA6",category_desc:"\u65B0\u3057\u3044\u30E1\u30FC\u30EB\u306E\u30C7\u30D5\u30A9\u30EB\u30C8\u30AB\u30C6\u30B4\u30EA",priority_desc:"\u65B0\u3057\u3044\u30E1\u30FC\u30EB\u306E\u30C7\u30D5\u30A9\u30EB\u30C8\u512A\u5148\u5EA6"},automation:{title:"\u81EA\u52D5\u5316\u8A2D\u5B9A",auto_summary:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u306E\u81EA\u52D5\u751F\u6210",auto_knowledge:"\u30CA\u30EC\u30C3\u30B8\u306E\u81EA\u52D5\u62BD\u51FA",enable_notifications:"\u901A\u77E5\u3092\u6709\u52B9\u5316",auto_summary_desc:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u81EA\u52D5\u7684\u306B\u751F\u6210\u3057\u307E\u3059",auto_knowledge_desc:"\u89E3\u6C7A\u6E08\u307F\u30E1\u30FC\u30EB\u304B\u3089\u30CA\u30EC\u30C3\u30B8\u3092\u81EA\u52D5\u62BD\u51FA\u3057\u307E\u3059",enable_notifications_desc:"\u30D7\u30E9\u30B0\u30A4\u30F3\u306E\u52D5\u4F5C\u306B\u5BFE\u3057\u3066\u901A\u77E5\u3092\u8868\u793A\u3057\u307E\u3059"},advanced:{title:"\u8A73\u7D30\u8A2D\u5B9A",max_attachment_size:"\u6700\u5927\u6DFB\u4ED8\u30D5\u30A1\u30A4\u30EB\u30B5\u30A4\u30BA (MB)",language:"\u8A00\u8A9E",max_attachment_size_desc:"\u6DFB\u4ED8\u30D5\u30A1\u30A4\u30EB\u306E\u6700\u5927\u30B5\u30A4\u30BA",language_desc:"\u30D7\u30E9\u30B0\u30A4\u30F3\u30A4\u30F3\u30BF\u30FC\u30D5\u30A7\u30FC\u30B9\u306E\u8A00\u8A9E"}},notices:{email_captured:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3\u3057\u307E\u3057\u305F: {{path}}",generating_summary:"{{date}}\u306E\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u751F\u6210\u4E2D...",summary_generated:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u304C\u6B63\u5E38\u306B\u751F\u6210\u3055\u308C\u307E\u3057\u305F",error_generating_summary:"\u30B5\u30DE\u30EA\u30FC\u751F\u6210\u30A8\u30E9\u30FC: {{error}}",knowledge_search_coming_soon:"\u77E5\u8B58\u691C\u7D22\u6A5F\u80FD\u306F\u8FD1\u65E5\u516C\u958B\u4E88\u5B9A\u3067\u3059...",bulk_import_coming_soon:"\u4E00\u62EC\u30A4\u30F3\u30DD\u30FC\u30C8\u6A5F\u80FD\u306F\u8FD1\u65E5\u516C\u958B\u4E88\u5B9A\u3067\u3059...",settings_saved:"\u8A2D\u5B9A\u304C\u6B63\u5E38\u306B\u4FDD\u5B58\u3055\u308C\u307E\u3057\u305F"},languages:{en:"English",ja:"\u65E5\u672C\u8A9E"}}});var V={};j(V,{default:()=>m});module.exports=L(V);var u=require("obsidian");var h=class o{constructor(e){this.data=e}static create(e){let t=this.generateId(),a=new Date,i={id:t,sender:e.sender,senderName:e.senderName,subject:e.subject,body:e.body,receivedDate:e.receivedDate,status:"pending",tags:e.tags||[],category:e.category,priority:e.priority,attachments:e.attachments,rawContent:e.rawContent,createdAt:a,updatedAt:a};return new o(i)}get id(){return this.data.id}get sender(){return this.data.sender}get senderName(){return this.data.senderName}get subject(){return this.data.subject}get body(){return this.data.body}get receivedDate(){return this.data.receivedDate}get status(){return this.data.status}get tags(){return this.data.tags}get category(){return this.data.category}get priority(){return this.data.priority}get attachments(){return this.data.attachments}get relatedEmails(){return this.data.relatedEmails}get knowledgeEntries(){return this.data.knowledgeEntries}get resolutionNoteId(){return this.data.resolutionNoteId}get rawContent(){return this.data.rawContent}get createdAt(){return this.data.createdAt}get updatedAt(){return this.data.updatedAt}updateStatus(e){this.data.status=e,this.data.updatedAt=new Date}addTag(e){this.data.tags.includes(e)||(this.data.tags.push(e),this.data.updatedAt=new Date)}removeTag(e){let t=this.data.tags.indexOf(e);t>-1&&(this.data.tags.splice(t,1),this.data.updatedAt=new Date)}setCategory(e){this.data.category=e,this.data.updatedAt=new Date}setPriority(e){this.data.priority=e,this.data.updatedAt=new Date}linkToKnowledgeEntry(e){this.data.knowledgeEntries||(this.data.knowledgeEntries=[]),this.data.knowledgeEntries.includes(e)||(this.data.knowledgeEntries.push(e),this.data.updatedAt=new Date)}setResolution(e){this.data.resolutionNoteId=e,this.data.status="resolved",this.data.updatedAt=new Date}linkRelatedEmail(e){this.data.relatedEmails||(this.data.relatedEmails=[]),this.data.relatedEmails.includes(e)||(this.data.relatedEmails.push(e),this.data.updatedAt=new Date)}setThreadId(e){this.data.threadId=e,this.data.updatedAt=new Date}validate(){let e=[];return this.data.id||e.push("ID is required"),this.data.sender||e.push("Sender is required"),this.data.subject||e.push("Subject is required"),this.data.body||e.push("Body is required"),this.data.receivedDate||e.push("Received date is required"),this.data.sender&&!this.isValidEmail(this.data.sender)&&e.push("Sender must be a valid email address"),e}isValid(){return this.validate().length===0}toJSON(){return{...this.data}}toFrontmatter(){return{id:this.data.id,sender:this.data.sender,senderName:this.data.senderName,subject:this.data.subject,receivedDate:this.data.receivedDate.toISOString(),status:this.data.status,tags:this.data.tags,category:this.data.category,threadId:this.data.threadId,priority:this.data.priority,attachments:this.data.attachments,relatedEmails:this.data.relatedEmails,knowledgeEntries:this.data.knowledgeEntries,resolutionNoteId:this.data.resolutionNoteId,createdAt:this.data.createdAt.toISOString(),updatedAt:this.data.updatedAt.toISOString()}}static fromJSON(e){let t={...e,receivedDate:new Date(e.receivedDate),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)};return new o(t)}static generateId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}};var y=class{constructor(e,t){this.vault=e,this.searchIndexer=t}async captureEmail(e){try{this.validateRequest(e);let t=this.createEmailFromRequest(e),a=await this.generateFilePath(t);e.attachments&&e.attachments.length>0&&await this.processAttachments(e.attachments,t.id);let i=this.generateNoteContent(t);return await this.vault.create(a,i),this.searchIndexer&&await this.searchIndexer.addEmail(t),{id:t.id,path:a,message:"Email captured successfully"}}catch(t){throw new Error(`Failed to capture email: ${t instanceof Error?t.message:String(t)}`)}}validateRequest(e){if(!e.sender)throw new Error("Sender is required");if(!e.subject)throw new Error("Subject is required");if(!e.body)throw new Error("Body is required");if(!e.receivedDate)throw new Error("Received date is required");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.sender))throw new Error("Invalid sender email format")}createEmailFromRequest(e){return h.create({sender:e.sender,senderName:e.senderName,subject:e.subject,body:e.body,receivedDate:new Date(e.receivedDate),category:e.category,priority:e.priority||"medium",tags:e.tags||[]})}async generateFilePath(e){let t=e.receivedDate,a=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=`Emails/${a}/${i}`;await this.vault.exists(s)||await this.vault.createFolder(s);let n=this.sanitizeFilename(e.subject),g=t.toTimeString().substring(0,5).replace(":","-"),E=`${r}-${g}-${n}.md`,S=`${s}/${E}`,b=1;for(;await this.vault.exists(S);)E=`${r}-${g}-${n}-${b}.md`,S=`${s}/${E}`,b++;return S}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"-").substring(0,50).toLowerCase()}async processAttachments(e,t){let a=`Emails/Attachments/${t}`;await this.vault.exists(a)||await this.vault.createFolder(a);for(let i of e)if(i.content){let r=Buffer.from(i.content,"base64"),s=`${a}/${i.filename}`;await this.vault.writeFile(s,r)}}generateNoteContent(e){return["---",this.generateFrontmatter(e),"---","",`# ${e.subject}`,"",`**From:** ${e.senderName||e.sender} <${e.sender}>`,`**Date:** ${e.receivedDate.toISOString()}`,`**Status:** ${e.status}`,...e.category?[`**Category:** ${e.category}`]:[],...e.priority?[`**Priority:** ${e.priority}`]:[],...e.tags.length>0?[`**Tags:** ${e.tags.join(", ")}`]:[],"","## Content","",e.body,"","## Notes","","<!-- Add your notes and resolution details here -->",""].join(`
`)}generateFrontmatter(e){let t=e.toFrontmatter(),a=[];for(let[i,r]of Object.entries(t))r!=null&&(Array.isArray(r)?r.length>0&&(a.push(`${i}:`),r.forEach(s=>a.push(`  - ${s}`))):typeof r=="string"?a.push(`${i}: "${r}"`):a.push(`${i}: ${r}`));return a.join(`
`)}};var f=class{constructor(){this.translations=new Map;this.currentLanguage="en";this.fallbackLanguage="en";this.detectLanguage()}async initialize(){try{let e=await this.loadTranslationFile("en");this.translations.set("en",e);let t=await this.loadTranslationFile("ja");this.translations.set("ja",t)}catch(e){console.error("Failed to load translations:",e),this.translations.set("en",{}),this.translations.set("ja",{})}}async loadTranslationFile(e){try{if(e==="en"){let t=await Promise.resolve().then(()=>I(F()));return t.default||t}else if(e==="ja"){let t=await Promise.resolve().then(()=>I(A()));return t.default||t}throw new Error(`Unsupported language: ${e}`)}catch(t){return console.error(`Failed to load ${e} translations:`,t),{}}}detectLanguage(){(navigator.language||"en").startsWith("ja")?this.currentLanguage="ja":this.currentLanguage="en"}setLanguage(e){this.currentLanguage=e}getCurrentLanguage(){return this.currentLanguage}getAvailableLanguages(){return["en","ja"]}t(e,t){let a=this.getTranslation(e,this.currentLanguage)||this.getTranslation(e,this.fallbackLanguage)||e;return t?this.replaceParams(a,t):a}getTranslation(e,t){let a=this.translations.get(t);if(!a)return null;let i=e.split("."),r=a;for(let s of i)if(r&&typeof r=="object"&&s in r)r=r[s];else return null;return typeof r=="string"?r:null}replaceParams(e,t){return e.replace(/\{\{(\w+)\}\}/g,(a,i)=>t[i]!==void 0?String(t[i]):a)}getTranslationGroup(e){let t=this.translations.get(this.currentLanguage)||{},a=e.split("."),i=t;for(let r of a)if(i&&typeof i=="object"&&r in i)i=i[r];else{let n=this.translations.get(this.fallbackLanguage)||{};for(let g of a)if(n&&typeof n=="object"&&g in n)n=n[g];else return{};i=n;break}return i&&typeof i=="object"?i:{}}};var d=require("obsidian"),v=class{constructor(e,t){this.vault=e;this.fileManager=t}async create(e,t){try{await this.vault.create(e,t)}catch(a){throw new Error(`Failed to create file ${e}: ${a}`)}}async exists(e){try{return this.vault.getAbstractFileByPath(e)!==null}catch{return!1}}async createFolder(e){try{let t=e.split("/"),a="";for(let i of t)a=a?`${a}/${i}`:i,await this.exists(a)||await this.vault.createFolder(a)}catch(t){throw new Error(`Failed to create folder ${e}: ${t}`)}}async writeFile(e,t){try{let a=e.substring(0,e.lastIndexOf("/"));a&&!await this.exists(a)&&await this.createFolder(a);let i;if(t instanceof Buffer){let r=new ArrayBuffer(t.length),s=new Uint8Array(r);for(let n=0;n<t.length;++n)s[n]=t[n];i=r}else i=t;await this.vault.createBinary(e,i)}catch(a){throw new Error(`Failed to write file ${e}: ${a}`)}}async read(e){try{let t=this.vault.getAbstractFileByPath(e);if(!t||!(t instanceof d.TFile))throw new Error(`File not found: ${e}`);return await this.vault.read(t)}catch(t){throw new Error(`Failed to read file ${e}: ${t}`)}}async modify(e,t){try{let a=this.vault.getAbstractFileByPath(e);if(!a||!(a instanceof d.TFile))throw new Error(`File not found: ${e}`);await this.vault.modify(a,t)}catch(a){throw new Error(`Failed to modify file ${e}: ${a}`)}}async delete(e){try{let t=this.vault.getAbstractFileByPath(e);if(!t)throw new Error(`File not found: ${e}`);await this.vault.delete(t)}catch(t){throw new Error(`Failed to delete file ${e}: ${t}`)}}async list(e){try{let t=this.vault.getAbstractFileByPath(e);if(!t||!(t instanceof d.TFolder))return[];let a=[],i=r=>{for(let s of r.children)s instanceof d.TFile?a.push(s.path):s instanceof d.TFolder&&i(s)};return i(t),a}catch(t){throw new Error(`Failed to list folder ${e}: ${t}`)}}async getFiles(e){try{if(e){let t=this.vault.getAbstractFileByPath(e);if(!t||!(t instanceof d.TFolder))return[];let a=[],i=r=>{for(let s of r.children)s instanceof d.TFile?a.push(s):s instanceof d.TFolder&&i(s)};return i(t),a}else return this.vault.getMarkdownFiles()}catch(t){throw new Error(`Failed to get files from ${e}: ${t}`)}}async rename(e,t){try{let a=this.vault.getAbstractFileByPath(e);if(!a)throw new Error(`File not found: ${e}`);await this.fileManager.renameFile(a,t)}catch(a){throw new Error(`Failed to rename ${e} to ${t}: ${a}`)}}async copy(e,t){try{let a=this.vault.getAbstractFileByPath(e);if(!a||!(a instanceof d.TFile))throw new Error(`Source file not found: ${e}`);let i=await this.vault.read(a);await this.create(t,i)}catch(a){throw new Error(`Failed to copy ${e} to ${t}: ${a}`)}}};var c=require("obsidian");var w=class extends c.Modal{constructor(e,t,a,i,r){super(e),this.emailCaptureService=t,this.settings=a,this.i18nService=i,this.onSuccess=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.i18nService.t("modal.capture_email.title")}),new c.Setting(e).setName(this.i18nService.t("modal.capture_email.sender_email")).setDesc("Email address of the person who sent the inquiry").addText(a=>{this.senderInput=a,a.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.sender_email")).onChange(i=>{this.validateEmail(i)})}),new c.Setting(e).setName(this.i18nService.t("modal.capture_email.sender_name")).setDesc("Display name of the sender (optional)").addText(a=>{this.senderNameInput=a,a.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.sender_name"))}),new c.Setting(e).setName(this.i18nService.t("modal.capture_email.subject")).setDesc("Email subject line").addText(a=>{this.subjectInput=a,a.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.subject"))}),new c.Setting(e).setName(this.i18nService.t("modal.capture_email.category")).setDesc("Categorize this inquiry").addDropdown(a=>{this.categoryDropdown=a;let i=this.i18nService.getTranslationGroup("categories");a.addOption("","Select category..."),a.addOption("specification",i.specification).addOption("issue",i.issue).addOption("migration_vup",i.migration_vup).addOption("other",i.other),this.settings.customCategories&&this.settings.customCategories.length>0&&(a.addOption("---","--- Custom Categories ---"),this.settings.customCategories.forEach(r=>{a.addOption(r,r)})),a.setValue(this.settings.defaultCategory)}),new c.Setting(e).setName(this.i18nService.t("modal.capture_email.priority")).setDesc("Priority level of this inquiry").addDropdown(a=>{this.priorityDropdown=a;let i=this.i18nService.getTranslationGroup("priorities");a.addOption("low",i.low).addOption("medium",i.medium).addOption("high",i.high).addOption("urgent",i.urgent).setValue(this.settings.defaultPriority)}),new c.Setting(e).setName(this.i18nService.t("modal.capture_email.tags")).setDesc("Comma-separated tags for this email").addText(a=>{this.tagsInput=a,a.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.tags"))}),new c.Setting(e).setName(this.i18nService.t("modal.capture_email.email_content")).setDesc("The main content of the email").addTextArea(a=>{this.bodyInput=a,a.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.email_content")).inputEl.style.height="200px"});let t=e.createDiv("modal-button-container");t.style.display="flex",t.style.justifyContent="space-between",t.style.marginTop="20px",t.createEl("button",{text:this.i18nService.t("modal.capture_email.cancel_button")},a=>{a.onclick=()=>{this.close()}}),t.createEl("button",{text:this.i18nService.t("modal.capture_email.capture_button"),cls:"mod-cta"},a=>{a.onclick=async()=>{await this.captureEmail()}}),setTimeout(()=>{this.senderInput.inputEl.focus()},100)}onClose(){let{contentEl:e}=this;e.empty()}validateEmail(e){let a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),i=this.senderInput.inputEl;return e&&!a?(i.style.borderColor="red",i.style.boxShadow="0 0 5px rgba(255, 0, 0, 0.3)"):(i.style.borderColor="",i.style.boxShadow=""),a}validateForm(){let e=[],t=this.senderInput.getValue().trim(),a=this.subjectInput.getValue().trim(),i=this.bodyInput.getValue().trim();return t?this.validateEmail(t)||e.push(this.i18nService.t("modal.capture_email.validation.sender_email_invalid")):e.push(this.i18nService.t("modal.capture_email.validation.sender_email_required")),a||e.push(this.i18nService.t("modal.capture_email.validation.subject_required")),i||e.push(this.i18nService.t("modal.capture_email.validation.content_required")),{isValid:e.length===0,errors:e}}async captureEmail(){try{let e=this.validateForm();if(!e.isValid){let s=e.errors.join(`
`);this.showError(`Please fix the following errors:

${s}`);return}let t={sender:this.senderInput.getValue().trim(),senderName:this.senderNameInput.getValue().trim()||void 0,subject:this.subjectInput.getValue().trim(),body:this.bodyInput.getValue().trim(),receivedDate:new Date().toISOString(),category:this.categoryDropdown.getValue()||void 0,priority:this.priorityDropdown.getValue()||"medium",tags:this.parseTags(this.tagsInput.getValue())},a=this.contentEl.querySelector(".mod-cta"),i=a.textContent;a.textContent="Capturing...",a.disabled=!0;let r=await this.emailCaptureService.captureEmail(t);this.onSuccess(r),this.close()}catch(e){this.showError(`Failed to capture email: ${e instanceof Error?e.message:String(e)}`);let t=this.contentEl.querySelector(".mod-cta");t.textContent="Capture Email",t.disabled=!1}}parseTags(e){return e.split(",").map(t=>t.trim()).filter(t=>t.length>0)}showError(e){let t=this.contentEl.querySelector(".modal-error");t&&t.remove();let a=this.contentEl.createDiv("modal-error");a.style.color="red",a.style.backgroundColor="rgba(255, 0, 0, 0.1)",a.style.padding="10px",a.style.marginTop="10px",a.style.borderRadius="4px",a.style.border="1px solid red",a.textContent=e,setTimeout(()=>{a.parentNode&&a.remove()},5e3)}};var l=require("obsidian");var _=class extends l.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=this.plugin.getI18nService();e.createEl("h2",{text:t.t("settings.title")}),e.createEl("h3",{text:t.t("settings.folders.title")}),new l.Setting(e).setName(t.t("settings.folders.emails_folder")).setDesc(t.t("settings.folders.emails_folder_desc")).addText(r=>r.setPlaceholder("Emails").setValue(this.plugin.settings.emailsFolder).onChange(async s=>{this.plugin.settings.emailsFolder=s||"Emails",await this.plugin.saveSettings()})),new l.Setting(e).setName(t.t("settings.folders.summaries_folder")).setDesc(t.t("settings.folders.summaries_folder_desc")).addText(r=>r.setPlaceholder("Summaries").setValue(this.plugin.settings.summariesFolder).onChange(async s=>{this.plugin.settings.summariesFolder=s||"Summaries",await this.plugin.saveSettings()})),new l.Setting(e).setName(t.t("settings.folders.knowledge_folder")).setDesc(t.t("settings.folders.knowledge_folder_desc")).addText(r=>r.setPlaceholder("Knowledge").setValue(this.plugin.settings.knowledgeFolder).onChange(async s=>{this.plugin.settings.knowledgeFolder=s||"Knowledge",await this.plugin.saveSettings()})),e.createEl("h3",{text:t.t("settings.defaults.title")}),new l.Setting(e).setName(t.t("settings.defaults.category")).setDesc(t.t("settings.defaults.category_desc")).addDropdown(r=>{let s=t.getTranslationGroup("categories");r.addOption("specification",s.specification).addOption("issue",s.issue).addOption("migration_vup",s.migration_vup).addOption("other",s.other),this.plugin.settings.customCategories&&this.plugin.settings.customCategories.length>0&&this.plugin.settings.customCategories.forEach(n=>{r.addOption(n,n)}),r.setValue(this.plugin.settings.defaultCategory).onChange(async n=>{this.plugin.settings.defaultCategory=n,await this.plugin.saveSettings()})}),new l.Setting(e).setName(t.t("settings.defaults.priority")).setDesc(t.t("settings.defaults.priority_desc")).addDropdown(r=>{let s=t.getTranslationGroup("priorities");r.addOption("low",s.low).addOption("medium",s.medium).addOption("high",s.high).addOption("urgent",s.urgent).setValue(this.plugin.settings.defaultPriority).onChange(async n=>{this.plugin.settings.defaultPriority=n,await this.plugin.saveSettings()})}),e.createEl("h3",{text:t.t("settings.automation.title")}),new l.Setting(e).setName(t.t("settings.automation.auto_summary")).setDesc(t.t("settings.automation.auto_summary_desc")).addToggle(r=>r.setValue(this.plugin.settings.autoGenerateSummary).onChange(async s=>{this.plugin.settings.autoGenerateSummary=s,await this.plugin.saveSettings()})),new l.Setting(e).setName(t.t("settings.automation.auto_knowledge")).setDesc(t.t("settings.automation.auto_knowledge_desc")).addToggle(r=>r.setValue(this.plugin.settings.autoExtractKnowledge).onChange(async s=>{this.plugin.settings.autoExtractKnowledge=s,await this.plugin.saveSettings()})),new l.Setting(e).setName(t.t("settings.automation.enable_notifications")).setDesc(t.t("settings.automation.enable_notifications_desc")).addToggle(r=>r.setValue(this.plugin.settings.enableNotifications).onChange(async s=>{this.plugin.settings.enableNotifications=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:t.t("settings.categories.title")});let a=e.createDiv("custom-categories-container");a.style.marginBottom="15px";let i=a.createEl("p",{text:t.t("settings.categories.manage_desc"),cls:"setting-item-description"});i.style.marginBottom="8px",i.style.color="var(--text-muted)",i.style.fontSize="13px",this.displayCustomCategories(a,t),new l.Setting(e).setName(t.t("settings.categories.add_category")).setDesc(t.t("settings.categories.add_category_desc")).addText(r=>{r.setPlaceholder(t.t("settings.categories.category_placeholder"));let s=e.createEl("button",{text:t.t("settings.categories.add_button"),cls:"mod-cta"});s.style.marginLeft="10px",s.onclick=async()=>{let n=r.getValue().trim();n&&!this.plugin.settings.customCategories.includes(n)&&(this.plugin.settings.customCategories.push(n),await this.plugin.saveSettings(),r.setValue(""),this.displayCustomCategories(a,t))},r.inputEl.parentElement?.appendChild(s)}),e.createEl("h3",{text:t.t("settings.advanced.title")}),new l.Setting(e).setName(t.t("settings.advanced.language")).setDesc(t.t("settings.advanced.language_desc")).addDropdown(r=>{let s=t.getTranslationGroup("languages");r.addOption("en",s.en).addOption("ja",s.ja).setValue(this.plugin.settings.language).onChange(async n=>{this.plugin.settings.language=n,await this.plugin.saveSettings(),this.display()})}),new l.Setting(e).setName(t.t("settings.advanced.max_attachment_size")).setDesc(t.t("settings.advanced.max_attachment_size_desc")).addText(r=>r.setPlaceholder("10").setValue(String(this.plugin.settings.maxAttachmentSize/(1024*1024))).onChange(async s=>{let n=parseFloat(s)||10;this.plugin.settings.maxAttachmentSize=n*1024*1024,await this.plugin.saveSettings()})),new l.Setting(e).setName("Reset Settings").setDesc("Reset all settings to default values").addButton(r=>r.setButtonText("Reset to Defaults").setWarning().onClick(async()=>{confirm("Are you sure you want to reset all settings to default values? This cannot be undone.")&&(this.plugin.settings={emailsFolder:"Emails",summariesFolder:"Summaries",knowledgeFolder:"Knowledge",defaultCategory:"specification",defaultPriority:"medium",autoGenerateSummary:!0,autoExtractKnowledge:!1,enableNotifications:!0,maxAttachmentSize:10*1024*1024,language:"en",customCategories:[]},await this.plugin.saveSettings(),this.display())})),e.createEl("h3",{text:"About"}),e.createEl("p",{text:"Email Inquiry Management Plugin v1.0.0 - Capture, organize, and build knowledge from email inquiries."})}displayCustomCategories(e,t){if(e.empty(),this.plugin.settings.customCategories.length===0){e.createEl("p",{text:t.t("settings.categories.no_custom_categories"),cls:"setting-item-description"});return}let a=e.createEl("div",{cls:"custom-categories-list"});a.style.display="flex",a.style.flexWrap="wrap",a.style.gap="8px",a.style.marginTop="8px",this.plugin.settings.customCategories.forEach((i,r)=>{let s=a.createEl("span",{text:i,cls:"category-tag"});s.style.backgroundColor="var(--interactive-accent)",s.style.color="var(--text-on-accent)",s.style.padding="4px 8px",s.style.borderRadius="12px",s.style.fontSize="12px",s.style.display="inline-flex",s.style.alignItems="center",s.style.gap="4px";let n=s.createEl("span",{text:"\xD7",cls:"category-remove"});n.style.cursor="pointer",n.style.fontWeight="bold",n.style.marginLeft="4px",n.style.opacity="0.8",n.style.fontSize="14px",n.style.lineHeight="1",n.style.width="16px",n.style.height="16px",n.style.display="inline-flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.borderRadius="50%",n.style.transition="all 0.2s ease",n.title=t.t("settings.categories.delete_tooltip"),n.addEventListener("mouseenter",()=>{n.style.opacity="1",n.style.backgroundColor="rgba(255, 255, 255, 0.2)",n.style.transform="scale(1.1)"}),n.addEventListener("mouseleave",()=>{n.style.opacity="0.8",n.style.backgroundColor="transparent",n.style.transform="scale(1)"}),n.onclick=async()=>{confirm(t.t("settings.categories.delete_confirm",{category:i}))&&(this.plugin.settings.customCategories.splice(r,1),await this.plugin.saveSettings(),this.displayCustomCategories(e,t))}})}};var M={emailsFolder:"Emails",summariesFolder:"Summaries",knowledgeFolder:"Knowledge",defaultCategory:"specification",defaultPriority:"medium",autoGenerateSummary:!0,autoExtractKnowledge:!1,enableNotifications:!0,maxAttachmentSize:10*1024*1024,language:"en",customCategories:[]},m=class extends u.Plugin{async onload(){console.log("Loading Email Inquiry Plugin"),await this.loadSettings(),this.i18nService=new f,await this.i18nService.initialize(),this.i18nService.setLanguage(this.settings.language),this.vaultAdapter=new v(this.app.vault,this.app.fileManager),this.emailCaptureService=new y(this.vaultAdapter),this.addSettingTab(new _(this.app,this)),this.registerCommands(),this.addRibbonIcon("mail",this.i18nService.t("ribbon.capture_email"),()=>{this.openEmailCaptureModal()}),console.log("Email Inquiry Plugin loaded successfully")}onunload(){console.log("Unloading Email Inquiry Plugin")}async loadSettings(){this.settings=Object.assign({},M,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.i18nService&&this.i18nService.setLanguage(this.settings.language)}registerCommands(){this.addCommand({id:"capture-email",name:this.i18nService.t("commands.capture_email"),callback:()=>{this.openEmailCaptureModal()}}),this.addCommand({id:"generate-daily-summary",name:this.i18nService.t("commands.generate_daily_summary"),callback:()=>{this.generateDailySummary()}}),this.addCommand({id:"search-knowledge-base",name:this.i18nService.t("commands.search_knowledge_base"),callback:()=>{this.openKnowledgeSearch()}}),this.addCommand({id:"bulk-import-emails",name:this.i18nService.t("commands.bulk_import_emails"),callback:()=>{this.openBulkImportModal()}})}openEmailCaptureModal(){new w(this.app,this.emailCaptureService,this.settings,this.i18nService,e=>{this.settings.enableNotifications&&new u.Notice(this.i18nService.t("notices.email_captured",{path:e.path}))}).open()}async generateDailySummary(){try{let e=new Date().toISOString().split("T")[0];new u.Notice(this.i18nService.t("notices.generating_summary",{date:e})),new u.Notice(this.i18nService.t("notices.summary_generated"))}catch(e){new u.Notice(this.i18nService.t("notices.error_generating_summary",{error:String(e)}))}}openKnowledgeSearch(){new u.Notice(this.i18nService.t("notices.knowledge_search_coming_soon"))}openBulkImportModal(){new u.Notice(this.i18nService.t("notices.bulk_import_coming_soon"))}getEmailsFolder(){return this.settings.emailsFolder}getSummariesFolder(){return this.settings.summariesFolder}getKnowledgeFolder(){return this.settings.knowledgeFolder}getI18nService(){return this.i18nService}};
