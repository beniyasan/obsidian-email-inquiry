/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
"use strict";var R=Object.create;var w=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var F=(l,t)=>()=>(t||l((t={exports:{}}).exports,t),t.exports),q=(l,t)=>{for(var e in t)w(l,e,{get:t[e],enumerable:!0})},I=(l,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of L(t))!V.call(l,r)&&r!==e&&w(l,r,{get:()=>t[r],enumerable:!(i=M(t,r))||i.enumerable});return l};var $=(l,t,e)=>(e=l!=null?R(K(l)):{},I(t||!l||!l.__esModule?w(e,"default",{value:l,enumerable:!0}):e,l)),B=l=>I(w({},"__esModule",{value:!0}),l);var k=F((ut,G)=>{G.exports={commands:{capture_email:"Capture Email",generate_daily_summary:"Generate Daily Summary",search_knowledge_base:"Search Knowledge Base",bulk_import_emails:"Bulk Import Emails"},ribbon:{capture_email:"Capture Email"},modal:{capture_email:{title:"Capture Email Inquiry",sender_email:"Sender Email",sender_name:"Sender Name",subject:"Subject",category:"Category",priority:"Priority",tags:"Tags",email_content:"Email Content",capture_button:"Capture Email",cancel_button:"Cancel",placeholder:{sender_email:"customer@example.com",sender_name:"John Customer (optional)",subject:"Login Issue - Cannot Access Dashboard",tags:"login-issue, dashboard, urgent",email_content:"Paste email content here..."},validation:{sender_email_required:"Sender email is required",sender_email_invalid:"Please enter a valid email address",subject_required:"Subject is required",content_required:"Email content is required"}}},categories:{specification:"Specification",issue:"Issue",migration_vup:"Migration/VUP",other:"Other"},priorities:{low:"Low",medium:"Medium",high:"High",urgent:"Urgent"},settings:{title:"Email Inquiry Management",folders:{title:"Folder Settings",emails_folder:"Emails Folder",summaries_folder:"Summaries Folder",knowledge_folder:"Knowledge Folder",emails_folder_desc:"Folder where captured emails will be stored",summaries_folder_desc:"Folder where daily summaries will be saved",knowledge_folder_desc:"Folder where extracted knowledge will be stored"},categories:{title:"Custom Categories",add_category:"Add Custom Category",add_category_desc:"Create a new category for email classification",add_button:"Add",category_placeholder:"Enter category name...",no_custom_categories:"No custom categories defined. Add categories to extend the default options.",manage_desc:"Click the \xD7 button to delete a category. This will not affect existing emails.",delete_confirm:"Are you sure you want to delete the category '{{category}}'? This action cannot be undone.",delete_tooltip:"Delete this category"},defaults:{title:"Default Values",category:"Default Category",priority:"Default Priority",category_desc:"Default category for new emails",priority_desc:"Default priority for new emails"},automation:{title:"Automation Settings",auto_summary:"Auto-generate Daily Summaries",auto_knowledge:"Auto-extract Knowledge",enable_notifications:"Enable Notifications",auto_summary_desc:"Automatically generate daily summaries",auto_knowledge_desc:"Automatically extract knowledge from resolved emails",enable_notifications_desc:"Show notifications for plugin actions"},advanced:{title:"Advanced Settings",max_attachment_size:"Max Attachment Size (MB)",language:"Language",max_attachment_size_desc:"Maximum file size for attachments",language_desc:"Plugin interface language"}},notices:{email_captured:"Email captured: {{path}}",generating_summary:"Generating daily summary for {{date}}...",summary_generated:"Daily summary generated successfully",summary_generated_with_path:"Daily summary generated ({{count}} emails): {{path}}",error_generating_summary:"Error generating summary: {{error}}",knowledge_search_coming_soon:"Knowledge search coming soon...",bulk_import_coming_soon:"Bulk import coming soon...",settings_saved:"Settings saved successfully"},languages:{en:"English",ja:"\u65E5\u672C\u8A9E"}}});var T=F((mt,U)=>{U.exports={commands:{capture_email:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3",generate_daily_summary:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u751F\u6210",search_knowledge_base:"\u77E5\u8B58\u30D9\u30FC\u30B9\u3092\u691C\u7D22",bulk_import_emails:"\u30E1\u30FC\u30EB\u306E\u4E00\u62EC\u30A4\u30F3\u30DD\u30FC\u30C8"},ribbon:{capture_email:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3"},modal:{capture_email:{title:"\u30E1\u30FC\u30EB\u554F\u3044\u5408\u308F\u305B\u3092\u30AD\u30E3\u30D7\u30C1\u30E3",sender_email:"\u9001\u4FE1\u8005\u30E1\u30FC\u30EB",sender_name:"\u9001\u4FE1\u8005\u540D",subject:"\u4EF6\u540D",category:"\u30AB\u30C6\u30B4\u30EA",priority:"\u512A\u5148\u5EA6",tags:"\u30BF\u30B0",email_content:"\u30E1\u30FC\u30EB\u5185\u5BB9",capture_button:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3",cancel_button:"\u30AD\u30E3\u30F3\u30BB\u30EB",placeholder:{sender_email:"customer@example.com",sender_name:"\u7530\u4E2D\u592A\u90CE\uFF08\u4EFB\u610F\uFF09",subject:"\u30ED\u30B0\u30A4\u30F3\u554F\u984C - \u30C0\u30C3\u30B7\u30E5\u30DC\u30FC\u30C9\u306B\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u307E\u305B\u3093",tags:"\u30ED\u30B0\u30A4\u30F3\u554F\u984C, \u30C0\u30C3\u30B7\u30E5\u30DC\u30FC\u30C9, \u7DCA\u6025",email_content:"\u30E1\u30FC\u30EB\u5185\u5BB9\u3092\u3053\u3053\u306B\u8CBC\u308A\u4ED8\u3051\u3066\u304F\u3060\u3055\u3044..."},validation:{sender_email_required:"\u9001\u4FE1\u8005\u30E1\u30FC\u30EB\u306F\u5FC5\u9808\u3067\u3059",sender_email_invalid:"\u6709\u52B9\u306A\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044",subject_required:"\u4EF6\u540D\u306F\u5FC5\u9808\u3067\u3059",content_required:"\u30E1\u30FC\u30EB\u5185\u5BB9\u306F\u5FC5\u9808\u3067\u3059"}}},categories:{specification:"\u4ED5\u69D8",issue:"\u969C\u5BB3",migration_vup:"\u79FB\u884C/VUP",other:"\u305D\u306E\u4ED6"},priorities:{low:"\u4F4E",medium:"\u4E2D",high:"\u9AD8",urgent:"\u7DCA\u6025"},settings:{title:"\u30E1\u30FC\u30EB\u554F\u3044\u5408\u308F\u305B\u7BA1\u7406",folders:{title:"\u30D5\u30A9\u30EB\u30C0\u8A2D\u5B9A",emails_folder:"\u30E1\u30FC\u30EB\u30D5\u30A9\u30EB\u30C0",summaries_folder:"\u30B5\u30DE\u30EA\u30FC\u30D5\u30A9\u30EB\u30C0",knowledge_folder:"\u30CA\u30EC\u30C3\u30B8\u30D5\u30A9\u30EB\u30C0",emails_folder_desc:"\u30AD\u30E3\u30D7\u30C1\u30E3\u3057\u305F\u30E1\u30FC\u30EB\u3092\u4FDD\u5B58\u3059\u308B\u30D5\u30A9\u30EB\u30C0",summaries_folder_desc:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u4FDD\u5B58\u3059\u308B\u30D5\u30A9\u30EB\u30C0",knowledge_folder_desc:"\u62BD\u51FA\u3057\u305F\u30CA\u30EC\u30C3\u30B8\u3092\u4FDD\u5B58\u3059\u308B\u30D5\u30A9\u30EB\u30C0"},categories:{title:"\u30AB\u30B9\u30BF\u30E0\u30AB\u30C6\u30B4\u30EA",add_category:"\u30AB\u30B9\u30BF\u30E0\u30AB\u30C6\u30B4\u30EA\u3092\u8FFD\u52A0",add_category_desc:"\u30E1\u30FC\u30EB\u5206\u985E\u7528\u306E\u65B0\u3057\u3044\u30AB\u30C6\u30B4\u30EA\u3092\u4F5C\u6210",add_button:"\u8FFD\u52A0",category_placeholder:"\u30AB\u30C6\u30B4\u30EA\u540D\u3092\u5165\u529B...",no_custom_categories:"\u30AB\u30B9\u30BF\u30E0\u30AB\u30C6\u30B4\u30EA\u304C\u5B9A\u7FA9\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002\u30C7\u30D5\u30A9\u30EB\u30C8\u30AA\u30D7\u30B7\u30E7\u30F3\u3092\u62E1\u5F35\u3059\u308B\u305F\u3081\u306B\u30AB\u30C6\u30B4\u30EA\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044\u3002",manage_desc:"\xD7\u30DC\u30BF\u30F3\u3092\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u30AB\u30C6\u30B4\u30EA\u3092\u524A\u9664\u3067\u304D\u307E\u3059\u3002\u65E2\u5B58\u306E\u30E1\u30FC\u30EB\u306B\u306F\u5F71\u97FF\u3057\u307E\u305B\u3093\u3002",delete_confirm:"\u30AB\u30C6\u30B4\u30EA '{{category}}' \u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F\u3053\u306E\u64CD\u4F5C\u306F\u5143\u306B\u623B\u305B\u307E\u305B\u3093\u3002",delete_tooltip:"\u3053\u306E\u30AB\u30C6\u30B4\u30EA\u3092\u524A\u9664"},defaults:{title:"\u30C7\u30D5\u30A9\u30EB\u30C8\u5024",category:"\u30C7\u30D5\u30A9\u30EB\u30C8\u30AB\u30C6\u30B4\u30EA",priority:"\u30C7\u30D5\u30A9\u30EB\u30C8\u512A\u5148\u5EA6",category_desc:"\u65B0\u3057\u3044\u30E1\u30FC\u30EB\u306E\u30C7\u30D5\u30A9\u30EB\u30C8\u30AB\u30C6\u30B4\u30EA",priority_desc:"\u65B0\u3057\u3044\u30E1\u30FC\u30EB\u306E\u30C7\u30D5\u30A9\u30EB\u30C8\u512A\u5148\u5EA6"},automation:{title:"\u81EA\u52D5\u5316\u8A2D\u5B9A",auto_summary:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u306E\u81EA\u52D5\u751F\u6210",auto_knowledge:"\u30CA\u30EC\u30C3\u30B8\u306E\u81EA\u52D5\u62BD\u51FA",enable_notifications:"\u901A\u77E5\u3092\u6709\u52B9\u5316",auto_summary_desc:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u81EA\u52D5\u7684\u306B\u751F\u6210\u3057\u307E\u3059",auto_knowledge_desc:"\u89E3\u6C7A\u6E08\u307F\u30E1\u30FC\u30EB\u304B\u3089\u30CA\u30EC\u30C3\u30B8\u3092\u81EA\u52D5\u62BD\u51FA\u3057\u307E\u3059",enable_notifications_desc:"\u30D7\u30E9\u30B0\u30A4\u30F3\u306E\u52D5\u4F5C\u306B\u5BFE\u3057\u3066\u901A\u77E5\u3092\u8868\u793A\u3057\u307E\u3059"},advanced:{title:"\u8A73\u7D30\u8A2D\u5B9A",max_attachment_size:"\u6700\u5927\u6DFB\u4ED8\u30D5\u30A1\u30A4\u30EB\u30B5\u30A4\u30BA (MB)",language:"\u8A00\u8A9E",max_attachment_size_desc:"\u6DFB\u4ED8\u30D5\u30A1\u30A4\u30EB\u306E\u6700\u5927\u30B5\u30A4\u30BA",language_desc:"\u30D7\u30E9\u30B0\u30A4\u30F3\u30A4\u30F3\u30BF\u30FC\u30D5\u30A7\u30FC\u30B9\u306E\u8A00\u8A9E"}},notices:{email_captured:"\u30E1\u30FC\u30EB\u3092\u30AD\u30E3\u30D7\u30C1\u30E3\u3057\u307E\u3057\u305F: {{path}}",generating_summary:"{{date}}\u306E\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u751F\u6210\u4E2D...",summary_generated:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u304C\u6B63\u5E38\u306B\u751F\u6210\u3055\u308C\u307E\u3057\u305F",summary_generated_with_path:"\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u304C\u751F\u6210\u3055\u308C\u307E\u3057\u305F ({{count}}\u4EF6): {{path}}",error_generating_summary:"\u30B5\u30DE\u30EA\u30FC\u751F\u6210\u30A8\u30E9\u30FC: {{error}}",knowledge_search_coming_soon:"\u77E5\u8B58\u691C\u7D22\u6A5F\u80FD\u306F\u8FD1\u65E5\u516C\u958B\u4E88\u5B9A\u3067\u3059...",bulk_import_coming_soon:"\u4E00\u62EC\u30A4\u30F3\u30DD\u30FC\u30C8\u6A5F\u80FD\u306F\u8FD1\u65E5\u516C\u958B\u4E88\u5B9A\u3067\u3059...",settings_saved:"\u8A2D\u5B9A\u304C\u6B63\u5E38\u306B\u4FDD\u5B58\u3055\u308C\u307E\u3057\u305F"},languages:{en:"English",ja:"\u65E5\u672C\u8A9E"}}});var W={};q(W,{default:()=>y});module.exports=B(W);var h=require("obsidian");var S=class l{constructor(t){this.data=t}static create(t){let e=this.generateId(),i=new Date,r={id:e,sender:t.sender,senderName:t.senderName,subject:t.subject,body:t.body,receivedDate:t.receivedDate,status:"pending",tags:t.tags||[],category:t.category,priority:t.priority,attachments:t.attachments,rawContent:t.rawContent,createdAt:i,updatedAt:i};return new l(r)}get id(){return this.data.id}get sender(){return this.data.sender}get senderName(){return this.data.senderName}get subject(){return this.data.subject}get body(){return this.data.body}get receivedDate(){return this.data.receivedDate}get status(){return this.data.status}get tags(){return this.data.tags}get category(){return this.data.category}get priority(){return this.data.priority}get attachments(){return this.data.attachments}get relatedEmails(){return this.data.relatedEmails}get knowledgeEntries(){return this.data.knowledgeEntries}get resolutionNoteId(){return this.data.resolutionNoteId}get rawContent(){return this.data.rawContent}get createdAt(){return this.data.createdAt}get updatedAt(){return this.data.updatedAt}updateStatus(t){this.data.status=t,this.data.updatedAt=new Date}addTag(t){this.data.tags.includes(t)||(this.data.tags.push(t),this.data.updatedAt=new Date)}removeTag(t){let e=this.data.tags.indexOf(t);e>-1&&(this.data.tags.splice(e,1),this.data.updatedAt=new Date)}setCategory(t){this.data.category=t,this.data.updatedAt=new Date}setPriority(t){this.data.priority=t,this.data.updatedAt=new Date}linkToKnowledgeEntry(t){this.data.knowledgeEntries||(this.data.knowledgeEntries=[]),this.data.knowledgeEntries.includes(t)||(this.data.knowledgeEntries.push(t),this.data.updatedAt=new Date)}setResolution(t){this.data.resolutionNoteId=t,this.data.status="resolved",this.data.updatedAt=new Date}linkRelatedEmail(t){this.data.relatedEmails||(this.data.relatedEmails=[]),this.data.relatedEmails.includes(t)||(this.data.relatedEmails.push(t),this.data.updatedAt=new Date)}setThreadId(t){this.data.threadId=t,this.data.updatedAt=new Date}validate(){let t=[];return this.data.id||t.push("ID is required"),this.data.sender||t.push("Sender is required"),this.data.subject||t.push("Subject is required"),this.data.body||t.push("Body is required"),this.data.receivedDate||t.push("Received date is required"),this.data.sender&&!this.isValidEmail(this.data.sender)&&t.push("Sender must be a valid email address"),t}isValid(){return this.validate().length===0}toJSON(){return{...this.data}}toFrontmatter(){return{id:this.data.id,sender:this.data.sender,senderName:this.data.senderName,subject:this.data.subject,receivedDate:this.data.receivedDate.toISOString(),status:this.data.status,tags:this.data.tags,category:this.data.category,threadId:this.data.threadId,priority:this.data.priority,attachments:this.data.attachments,relatedEmails:this.data.relatedEmails,knowledgeEntries:this.data.knowledgeEntries,resolutionNoteId:this.data.resolutionNoteId,createdAt:this.data.createdAt.toISOString(),updatedAt:this.data.updatedAt.toISOString()}}static fromJSON(t){let e={...t,receivedDate:new Date(t.receivedDate),createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)};return new l(e)}static generateId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}};var p=class{constructor(t,e="Emails",i,r){this.vault=t,this.emailsFolder=e,this.searchIndexer=i,this.knowledgeExtractionService=r}async captureEmail(t){try{this.validateRequest(t);let e=this.createEmailFromRequest(t),i=await this.generateFilePath(e);t.attachments&&t.attachments.length>0&&await this.processAttachments(t.attachments,e.id);let r=this.generateNoteContent(e);await this.vault.create(i,r),this.searchIndexer&&await this.searchIndexer.addEmail(e);let a=null;if(this.knowledgeExtractionService&&this.knowledgeExtractionService.isEligibleForExtraction(e))try{a=await this.knowledgeExtractionService.extractKnowledgeFromEmail(e),console.log("[EmailCapture] Knowledge extracted:",a)}catch(s){console.error("[EmailCapture] Knowledge extraction failed:",s)}return{id:e.id,path:i,message:a?`Email captured successfully. Knowledge extracted to: ${a}`:"Email captured successfully"}}catch(e){throw new Error(`Failed to capture email: ${e instanceof Error?e.message:String(e)}`)}}validateRequest(t){if(!t.sender)throw new Error("Sender is required");if(!t.subject)throw new Error("Subject is required");if(!t.body)throw new Error("Body is required");if(!t.receivedDate)throw new Error("Received date is required");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.sender))throw new Error("Invalid sender email format")}createEmailFromRequest(t){return S.create({sender:t.sender,senderName:t.senderName,subject:t.subject,body:t.body,receivedDate:new Date(t.receivedDate),category:t.category,priority:t.priority||"medium",tags:t.tags||[]})}async generateFilePath(t){let e=t.receivedDate,i=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),s=`${this.emailsFolder}/${i}/${r}`;await this.vault.exists(s)||await this.vault.createFolder(s);let n=this.sanitizeFilename(t.subject),d=e.toTimeString().substring(0,5).replace(":","-"),o=`${a}-${d}-${n}.md`,g=`${s}/${o}`,f=1;for(;await this.vault.exists(g);)o=`${a}-${d}-${n}-${f}.md`,g=`${s}/${o}`,f++;return g}sanitizeFilename(t){return t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"-").substring(0,50).toLowerCase()}async processAttachments(t,e){let i=`${this.emailsFolder}/Attachments/${e}`;await this.vault.exists(i)||await this.vault.createFolder(i);for(let r of t)if(r.content){let a=Buffer.from(r.content,"base64"),s=`${i}/${r.filename}`;await this.vault.writeFile(s,a)}}generateNoteContent(t){return["---",this.generateFrontmatter(t),"---","",`# ${t.subject}`,"",`**From:** ${t.senderName||t.sender} <${t.sender}>`,`**Date:** ${t.receivedDate.toISOString()}`,`**Status:** ${t.status}`,...t.category?[`**Category:** ${t.category}`]:[],...t.priority?[`**Priority:** ${t.priority}`]:[],...t.tags.length>0?[`**Tags:** ${t.tags.join(", ")}`]:[],"","## Content","",t.body,"","## Notes","","<!-- Add your notes and resolution details here -->",""].join(`
`)}generateFrontmatter(t){let e=t.toFrontmatter(),i=[];for(let[r,a]of Object.entries(e))a!=null&&(Array.isArray(a)?a.length>0&&(i.push(`${r}:`),a.forEach(s=>i.push(`  - ${s}`))):typeof a=="string"?i.push(`${r}: "${a}"`):i.push(`${r}: ${a}`));return i.join(`
`)}};var C=class l{constructor(t){this.data=t}static create(t){let e=new Date,i=crypto.randomUUID();return new l({id:i,title:t.title,problem:t.problem,solution:t.solution,category:t.category,keywords:t.keywords,sourceEmailId:t.sourceEmailId,tags:t.tags,createdAt:e,updatedAt:e})}get id(){return this.data.id}get title(){return this.data.title}get problem(){return this.data.problem}get solution(){return this.data.solution}get category(){return this.data.category}get keywords(){return this.data.keywords}get sourceEmailId(){return this.data.sourceEmailId}get tags(){return this.data.tags}get createdAt(){return this.data.createdAt}toFrontmatter(){return{id:this.data.id,title:this.data.title,category:this.data.category,keywords:this.data.keywords,sourceEmailId:this.data.sourceEmailId,tags:this.data.tags,createdAt:this.data.createdAt.toISOString(),updatedAt:this.data.updatedAt.toISOString()}}},v=class{constructor(t,e){this.vault=t,this.settings=e}async extractKnowledgeFromEmail(t){if(t.status!=="resolved")return console.log(`[KnowledgeExtraction] Skipping knowledge extraction - email not resolved (status: ${t.status})`),null;if(!this.settings.autoExtractKnowledge)return console.log("[KnowledgeExtraction] Auto-extraction is disabled"),null;try{console.log(`[KnowledgeExtraction] Extracting knowledge from email: ${t.id}`);let e=await this.createKnowledgeEntry(t),i=await this.generateKnowledgeFilePath(e),r=this.generateKnowledgeContent(e,t);return await this.vault.create(i,r),console.log(`[KnowledgeExtraction] Knowledge extracted successfully: ${i}`),i}catch(e){throw console.error(`[KnowledgeExtraction] Failed to extract knowledge from email ${t.id}:`,e),new Error(`Failed to extract knowledge: ${e instanceof Error?e.message:String(e)}`)}}isEligibleForExtraction(t){return this.settings.autoExtractKnowledge&&t.status==="resolved"&&t.body.length>50}async createKnowledgeEntry(t){let e=this.extractProblemStatement(t.body),r=this.extractSolution(t.body,""),a=this.extractKeywords(t);return C.create({title:this.generateKnowledgeTitle(t.subject),problem:e,solution:r,category:t.category,keywords:a,sourceEmailId:t.id,tags:[...t.tags,"auto-extracted"]})}extractProblemStatement(t){let i=t.split(/[.!?]+/).map(a=>a.trim()).filter(a=>a.length>0).filter(a=>/\b(how|what|why|when|where|どう|何|なぜ|いつ|どこ|問題|エラー|できない|わからない)/i.test(a)).slice(0,3);if(i.length>0)return i.join(". ")+".";let r=t.split(`

`)[0];return r.length>200?r.substring(0,200)+"...":r}extractSolution(t,e){if(e&&e.trim().length>10)return e;let r=t.split(/[.!?]+/).map(a=>a.trim()).filter(a=>a.length>0).filter(a=>/\b(解決|修正|対応|fix|resolve|solve|solution|答え|回答|方法)/i.test(a)).slice(0,3);return r.length>0?r.join(". ")+".":"\u89E3\u6C7A\u65B9\u6CD5\u306B\u3064\u3044\u3066\u306F\u8A73\u7D30\u306A\u8ABF\u67FB\u304C\u5FC5\u8981\u3067\u3059\u3002"}extractKeywords(t){let e=`${t.subject} ${t.body}`.toLowerCase(),i=[];return["api","database","server","client","network","security","auth","login","password","error","bug","performance","timeout","\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9","\u30B5\u30FC\u30D0\u30FC","\u30CD\u30C3\u30C8\u30EF\u30FC\u30AF","\u30A8\u30E9\u30FC","\u30D0\u30B0","\u30D1\u30D5\u30A9\u30FC\u30DE\u30F3\u30B9"].forEach(a=>{e.includes(a)&&i.push(a)}),t.category&&i.push(t.category),i.push(...t.tags),[...new Set(i)]}generateKnowledgeTitle(t){let e=t.replace(/^(re:|fwd?:|fw:)\s*/i,"").replace(/\[.*?\]/g,"").trim();return/\b(解決|方法|how\s+to|solution|fix)/i.test(e)||(e=`\u89E3\u6C7A\u65B9\u6CD5: ${e}`),e}async generateKnowledgeFilePath(t){let e=new Date,i=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=`${this.settings.knowledgeFolder}/${i}/${r}`;await this.vault.exists(a)||await this.vault.createFolder(a);let s=this.sanitizeFilename(t.title),n=`${s}.md`,d=`${a}/${n}`,o=1;for(;await this.vault.exists(d);)n=`${s}-${o}.md`,d=`${a}/${n}`,o++;return d}generateKnowledgeContent(t,e){let i=t.toFrontmatter(),r=[];for(let[s,n]of Object.entries(i))n!=null&&(Array.isArray(n)?n.length>0&&(r.push(`${s}:`),n.forEach(d=>r.push(`  - "${d}"`))):typeof n=="string"?r.push(`${s}: "${n}"`):r.push(`${s}: ${n}`));return["---",r.join(`
`),"---","",`# ${t.title}`,"","## \u554F\u984C\u30FB\u8CEA\u554F","",t.problem,"","## \u89E3\u6C7A\u65B9\u6CD5\u30FB\u56DE\u7B54","",t.solution,"","## \u95A2\u9023\u60C5\u5831","",`**\u30AB\u30C6\u30B4\u30EA:** ${t.category||"\u305D\u306E\u4ED6"}`,`**\u30AD\u30FC\u30EF\u30FC\u30C9:** ${t.keywords.join(", ")}`,`**\u5143\u306E\u30E1\u30FC\u30EB:** [[${e.subject}]]`,`**\u4F5C\u6210\u65E5:** ${t.createdAt.toISOString().split("T")[0]}`,"","## \u30E1\u30E2","","<!-- \u8FFD\u52A0\u306E\u60C5\u5831\u3084\u95A2\u9023\u4E8B\u9805\u304C\u3042\u308C\u3070\u8A18\u9332\u3057\u3066\u304F\u3060\u3055\u3044 -->",""].join(`
`)}sanitizeFilename(t){return t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"-").substring(0,50).toLowerCase()}updateSettings(t){this.settings=t}};var E=class{constructor(t,e){this.vault=t,this.settings=e}async generateSummary(t){try{console.log(`[DailySummary] Generating summary for date: ${t.date}`);let e=await this.collectEmailsForDate(t.date,t.includePreviousDays||0);if(e.length===0)throw console.log("[DailySummary] No emails found for the specified date"),new Error("\u6307\u5B9A\u3055\u308C\u305F\u65E5\u4ED8\u306B\u30E1\u30FC\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");let i=this.generateStatistics(e),r=this.generateSummaryContent(t.date,e,i),a=await this.generateSummaryFilePath(t.date);return await this.vault.create(a,r),console.log(`[DailySummary] Summary generated successfully: ${a}`),{date:t.date,filePath:a,stats:i,message:`\u65E5\u6B21\u30B5\u30DE\u30EA\u30FC\u3092\u751F\u6210\u3057\u307E\u3057\u305F: ${a}`}}catch(e){throw console.error("[DailySummary] Failed to generate summary:",e),new Error(`\u30B5\u30DE\u30EA\u30FC\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F: ${e instanceof Error?e.message:String(e)}`)}}async collectEmailsForDate(t,e=0){let i=[],r=new Date(t),a=new Date(r);a.setDate(a.getDate()-e),console.log(`[DailySummary] Collecting emails from ${a.toISOString().split("T")[0]} to ${t}`);try{let s=new Date(a);for(;s<=r;){let n=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),o=`${this.settings.emailsFolder}/${n}/${d}`;if(await this.vault.exists(o)){let g=await this.collectEmailsFromFolder(o,s);i.push(...g)}s.setDate(s.getDate()+1)}}catch(s){console.error("[DailySummary] Error collecting emails:",s)}return console.log(`[DailySummary] Collected ${i.length} emails`),i}async collectEmailsFromFolder(t,e){let i=[],r=e.toISOString().split("T")[0],a=String(e.getDate()).padStart(2,"0");try{console.log(`[DailySummary] Scanning folder: ${t} for date: ${r}`)}catch(s){console.error(`[DailySummary] Error reading folder ${t}:`,s)}return i}generateStatistics(t){let e={totalEmails:t.length,byCategory:{},byPriority:{},byStatus:{},topSenders:[],commonTags:[]},i={},r={};return t.forEach(a=>{let s=a.category||"\u305D\u306E\u4ED6";e.byCategory[s]=(e.byCategory[s]||0)+1;let n=a.priority||"medium";e.byPriority[n]=(e.byPriority[n]||0)+1,e.byStatus[a.status]=(e.byStatus[a.status]||0)+1,i[a.sender]||(i[a.sender]={name:a.senderName,count:0}),i[a.sender].count++,a.tags.forEach(d=>{r[d]=(r[d]||0)+1})}),e.topSenders=Object.entries(i).map(([a,s])=>({email:a,name:s.name,count:s.count})).sort((a,s)=>s.count-a.count).slice(0,10),e.commonTags=Object.entries(r).map(([a,s])=>({tag:a,count:s})).sort((a,s)=>s.count-a.count).slice(0,15),e}generateSummaryContent(t,e,i){let r=new Date(t),a=this.settings.language==="ja"?`${r.getFullYear()}\u5E74${r.getMonth()+1}\u6708${r.getDate()}\u65E5`:r.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),s={date:t,type:"daily-summary",totalEmails:i.totalEmails,createdAt:new Date().toISOString(),language:this.settings.language},n=[];for(let[o,g]of Object.entries(s))typeof g=="string"?n.push(`${o}: "${g}"`):n.push(`${o}: ${g}`);return["---",n.join(`
`),"---","",`# \u{1F4E7} ${a} \u30E1\u30FC\u30EB\u554F\u3044\u5408\u308F\u305B\u30B5\u30DE\u30EA\u30FC`,"","## \u{1F4CA} \u6982\u8981","",`- **\u7DCF\u30E1\u30FC\u30EB\u6570**: ${i.totalEmails}\u4EF6`,`- **\u751F\u6210\u65E5\u6642**: ${new Date().toLocaleString("ja-JP")}`,"","## \u{1F4C8} \u7D71\u8A08\u60C5\u5831","","### \u30AB\u30C6\u30B4\u30EA\u5225","",...this.generateStatTable(i.byCategory,this.getCategoryDisplayName.bind(this)),"","### \u512A\u5148\u5EA6\u5225","",...this.generateStatTable(i.byPriority,this.getPriorityDisplayName.bind(this)),"","### \u30B9\u30C6\u30FC\u30BF\u30B9\u5225","",...this.generateStatTable(i.byStatus,this.getStatusDisplayName.bind(this)),"","## \u{1F465} \u9001\u4FE1\u8005\u5206\u6790","",...i.topSenders.length>0?["| \u9001\u4FE1\u8005 | \u4EF6\u6570 |","|--------|------|",...i.topSenders.map(o=>`| ${o.name||o.email} | ${o.count}\u4EF6 |`)]:["\u9001\u4FE1\u8005\u30C7\u30FC\u30BF\u304C\u3042\u308A\u307E\u305B\u3093\u3002"],"","## \u{1F3F7}\uFE0F \u3088\u304F\u4F7F\u308F\u308C\u305F\u30BF\u30B0","",...i.commonTags.length>0?[i.commonTags.slice(0,10).map(o=>`- **${o.tag}** (${o.count}\u4EF6)`).join(`
`)]:["\u30BF\u30B0\u30C7\u30FC\u30BF\u304C\u3042\u308A\u307E\u305B\u3093\u3002"],"","## \u{1F4CB} \u8A73\u7D30\u30E1\u30FC\u30EB\u4E00\u89A7","",...e.length>0?["| \u6642\u523B | \u9001\u4FE1\u8005 | \u4EF6\u540D | \u30AB\u30C6\u30B4\u30EA | \u30B9\u30C6\u30FC\u30BF\u30B9 |","|------|--------|------|----------|------------|",...e.slice(0,50).map(o=>{let g=o.receivedDate.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),f=o.senderName||o.sender,N=o.subject.length>30?o.subject.substring(0,30)+"...":o.subject,j=this.getCategoryDisplayName(o.category||""),O=this.getStatusDisplayName(o.status);return`| ${g} | ${f} | ${N} | ${j} | ${O} |`}),...e.length>50?[`
*...\u4ED6${e.length-50}\u4EF6*`]:[]]:["\u30E1\u30FC\u30EB\u30C7\u30FC\u30BF\u304C\u3042\u308A\u307E\u305B\u3093\u3002"],"","## \u{1F4A1} \u30A4\u30F3\u30B5\u30A4\u30C8","",...this.generateInsights(i),"","---","","> \u3053\u306E\u30B5\u30DE\u30EA\u30FC\u306F\u81EA\u52D5\u751F\u6210\u3055\u308C\u307E\u3057\u305F\u3002","> \u751F\u6210\u5143: Email Inquiry Management Plugin v1.0.0",""].join(`
`)}generateStatTable(t,e){return Object.keys(t).length===0?["\u30C7\u30FC\u30BF\u304C\u3042\u308A\u307E\u305B\u3093\u3002"]:["| \u9805\u76EE | \u4EF6\u6570 | \u5272\u5408 |","|------|------|------|",...Object.entries(t).sort(([,r],[,a])=>a-r).map(([r,a])=>{let s=Object.values(t).reduce((d,o)=>d+o,0),n=s>0?Math.round(a/s*100):0;return`| ${e(r)} | ${a}\u4EF6 | ${n}% |`})]}generateInsights(t){let e=[];t.totalEmails>20?e.push("\u{1F525} **\u9AD8\u3044\u554F\u3044\u5408\u308F\u305B\u91CF**: \u4ECA\u65E5\u306F\u901A\u5E38\u3088\u308A\u591A\u304F\u306E\u554F\u3044\u5408\u308F\u305B\u304C\u3042\u308A\u307E\u3057\u305F\u3002"):t.totalEmails<5&&e.push("\u{1F4C9} **\u4F4E\u3044\u554F\u3044\u5408\u308F\u305B\u91CF**: \u4ECA\u65E5\u306F\u6BD4\u8F03\u7684\u9759\u304B\u306A\u4E00\u65E5\u3067\u3057\u305F\u3002");let i=Object.entries(t.byCategory).sort(([,d],[,o])=>o-d)[0];i&&i[1]>t.totalEmails*.4&&e.push(`\u{1F4C2} **\u4E3B\u8981\u30AB\u30C6\u30B4\u30EA**: ${this.getCategoryDisplayName(i[0])}\u306E\u554F\u3044\u5408\u308F\u305B\u304C\u591A\u304F\u3092\u5360\u3081\u3066\u3044\u307E\u3059 (${i[1]}\u4EF6)\u3002`);let r=t.byPriority.high||0,a=t.byPriority.urgent||0;r+a>t.totalEmails*.3&&e.push("\u26A0\uFE0F **\u512A\u5148\u5EA6\u9AD8**: \u7DCA\u6025\u6027\u306E\u9AD8\u3044\u554F\u3044\u5408\u308F\u305B\u304C\u591A\u304F\u898B\u3064\u304B\u308A\u307E\u3057\u305F\u3002\u65E9\u6025\u306A\u5BFE\u5FDC\u304C\u5FC5\u8981\u3067\u3059\u3002");let s=t.byStatus.resolved||0,n=t.totalEmails>0?Math.round(s/t.totalEmails*100):0;return n>80?e.push(`\u2705 **\u9AD8\u89E3\u6C7A\u7387**: \u89E3\u6C7A\u7387${n}%\u3068\u9AD8\u3044\u30D1\u30D5\u30A9\u30FC\u30DE\u30F3\u30B9\u3092\u793A\u3057\u3066\u3044\u307E\u3059\u3002`):n<30&&e.push(`\u{1F4CB} **\u8981\u30D5\u30A9\u30ED\u30FC\u30A2\u30C3\u30D7**: \u89E3\u6C7A\u7387${n}%\u3068\u4F4E\u304F\u3001\u672A\u89E3\u6C7A\u306E\u554F\u3044\u5408\u308F\u305B\u304C\u591A\u304F\u6B8B\u3063\u3066\u3044\u307E\u3059\u3002`),t.topSenders.length>0&&t.topSenders[0].count>3&&e.push(`\u{1F464} **\u983B\u51FA\u9001\u4FE1\u8005**: ${t.topSenders[0].name||t.topSenders[0].email}\u304B\u3089${t.topSenders[0].count}\u4EF6\u306E\u554F\u3044\u5408\u308F\u305B\u304C\u3042\u308A\u307E\u3057\u305F\u3002`),e.length===0&&e.push("\u{1F4DD} \u7279\u306B\u6CE8\u76EE\u3059\u3079\u304D\u50BE\u5411\u306F\u898B\u3089\u308C\u307E\u305B\u3093\u3067\u3057\u305F\u3002"),e}getCategoryDisplayName(t){return{specification:"\u4ED5\u69D8",issue:"\u969C\u5BB3",migration_vup:"\u79FB\u884C/VUP",other:"\u305D\u306E\u4ED6"}[t]||t||"\u305D\u306E\u4ED6"}getPriorityDisplayName(t){return{low:"\u4F4E",medium:"\u4E2D",high:"\u9AD8",urgent:"\u7DCA\u6025"}[t]||t||"\u4E2D"}getStatusDisplayName(t){return{pending:"\u672A\u5BFE\u5FDC",in_progress:"\u5BFE\u5FDC\u4E2D",resolved:"\u89E3\u6C7A\u6E08\u307F",archived:"\u30A2\u30FC\u30AB\u30A4\u30D6"}[t]||t||"\u672A\u5BFE\u5FDC"}async generateSummaryFilePath(t){let e=new Date(t),i=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=`${this.settings.summariesFolder}/${i}`;await this.vault.exists(a)||await this.vault.createFolder(a);let s=`${t}-daily-summary.md`,n=`${a}/${s}`,d=1;for(;await this.vault.exists(n);){let o=`${t}-daily-summary-${d}.md`;n=`${a}/${o}`,d++}return n}updateSettings(t){this.settings=t}};var b=class{constructor(){this.translations=new Map;this.currentLanguage="en";this.fallbackLanguage="en";this.detectLanguage()}async initialize(){try{let t=await this.loadTranslationFile("en");this.translations.set("en",t);let e=await this.loadTranslationFile("ja");this.translations.set("ja",e)}catch(t){console.error("Failed to load translations:",t),this.translations.set("en",{}),this.translations.set("ja",{})}}async loadTranslationFile(t){try{if(t==="en"){let e=await Promise.resolve().then(()=>$(k()));return e.default||e}else if(t==="ja"){let e=await Promise.resolve().then(()=>$(T()));return e.default||e}throw new Error(`Unsupported language: ${t}`)}catch(e){return console.error(`Failed to load ${t} translations:`,e),{}}}detectLanguage(){(navigator.language||"en").startsWith("ja")?this.currentLanguage="ja":this.currentLanguage="en"}setLanguage(t){this.currentLanguage=t}getCurrentLanguage(){return this.currentLanguage}getAvailableLanguages(){return["en","ja"]}t(t,e){let i=this.getTranslation(t,this.currentLanguage)||this.getTranslation(t,this.fallbackLanguage)||t;return e?this.replaceParams(i,e):i}getTranslation(t,e){let i=this.translations.get(e);if(!i)return null;let r=t.split("."),a=i;for(let s of r)if(a&&typeof a=="object"&&s in a)a=a[s];else return null;return typeof a=="string"?a:null}replaceParams(t,e){return t.replace(/\{\{(\w+)\}\}/g,(i,r)=>e[r]!==void 0?String(e[r]):i)}getTranslationGroup(t){let e=this.translations.get(this.currentLanguage)||{},i=t.split("."),r=e;for(let a of i)if(r&&typeof r=="object"&&a in r)r=r[a];else{let n=this.translations.get(this.fallbackLanguage)||{};for(let d of i)if(n&&typeof n=="object"&&d in n)n=n[d];else return{};r=n;break}return r&&typeof r=="object"?r:{}}};var u=require("obsidian"),_=class{constructor(t,e){this.vault=t;this.fileManager=e}async create(t,e){try{await this.vault.create(t,e)}catch(i){throw new Error(`Failed to create file ${t}: ${i}`)}}async exists(t){try{return this.vault.getAbstractFileByPath(t)!==null}catch{return!1}}async createFolder(t){try{let e=t.split("/"),i="";for(let r of e)i=i?`${i}/${r}`:r,await this.exists(i)||await this.vault.createFolder(i)}catch(e){throw new Error(`Failed to create folder ${t}: ${e}`)}}async writeFile(t,e){try{let i=t.substring(0,t.lastIndexOf("/"));i&&!await this.exists(i)&&await this.createFolder(i);let r;if(e instanceof Buffer){let a=new ArrayBuffer(e.length),s=new Uint8Array(a);for(let n=0;n<e.length;++n)s[n]=e[n];r=a}else r=e;await this.vault.createBinary(t,r)}catch(i){throw new Error(`Failed to write file ${t}: ${i}`)}}async read(t){try{let e=this.vault.getAbstractFileByPath(t);if(!e||!(e instanceof u.TFile))throw new Error(`File not found: ${t}`);return await this.vault.read(e)}catch(e){throw new Error(`Failed to read file ${t}: ${e}`)}}async modify(t,e){try{let i=this.vault.getAbstractFileByPath(t);if(!i||!(i instanceof u.TFile))throw new Error(`File not found: ${t}`);await this.vault.modify(i,e)}catch(i){throw new Error(`Failed to modify file ${t}: ${i}`)}}async delete(t){try{let e=this.vault.getAbstractFileByPath(t);if(!e)throw new Error(`File not found: ${t}`);await this.vault.delete(e)}catch(e){throw new Error(`Failed to delete file ${t}: ${e}`)}}async list(t){try{let e=this.vault.getAbstractFileByPath(t);if(!e||!(e instanceof u.TFolder))return[];let i=[],r=a=>{for(let s of a.children)s instanceof u.TFile?i.push(s.path):s instanceof u.TFolder&&r(s)};return r(e),i}catch(e){throw new Error(`Failed to list folder ${t}: ${e}`)}}async getFiles(t){try{if(t){let e=this.vault.getAbstractFileByPath(t);if(!e||!(e instanceof u.TFolder))return[];let i=[],r=a=>{for(let s of a.children)s instanceof u.TFile?i.push(s):s instanceof u.TFolder&&r(s)};return r(e),i}else return this.vault.getMarkdownFiles()}catch(e){throw new Error(`Failed to get files from ${t}: ${e}`)}}async rename(t,e){try{let i=this.vault.getAbstractFileByPath(t);if(!i)throw new Error(`File not found: ${t}`);await this.fileManager.renameFile(i,e)}catch(i){throw new Error(`Failed to rename ${t} to ${e}: ${i}`)}}async copy(t,e){try{let i=this.vault.getAbstractFileByPath(t);if(!i||!(i instanceof u.TFile))throw new Error(`Source file not found: ${t}`);let r=await this.vault.read(i);await this.create(e,r)}catch(i){throw new Error(`Failed to copy ${t} to ${e}: ${i}`)}}};var m=require("obsidian");var x=class extends m.Modal{constructor(t,e,i,r,a){super(t),this.emailCaptureService=e,this.settings=i,this.i18nService=r,this.onSuccess=a}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.i18nService.t("modal.capture_email.title")}),new m.Setting(t).setName(this.i18nService.t("modal.capture_email.sender_email")).setDesc("Email address of the person who sent the inquiry").addText(i=>{this.senderInput=i,i.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.sender_email")).onChange(r=>{this.validateEmail(r)})}),new m.Setting(t).setName(this.i18nService.t("modal.capture_email.sender_name")).setDesc("Display name of the sender (optional)").addText(i=>{this.senderNameInput=i,i.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.sender_name"))}),new m.Setting(t).setName(this.i18nService.t("modal.capture_email.subject")).setDesc("Email subject line").addText(i=>{this.subjectInput=i,i.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.subject"))}),new m.Setting(t).setName(this.i18nService.t("modal.capture_email.category")).setDesc("Categorize this inquiry").addDropdown(i=>{this.categoryDropdown=i;let r=this.i18nService.getTranslationGroup("categories");i.addOption("","Select category..."),i.addOption("specification",r.specification).addOption("issue",r.issue).addOption("migration_vup",r.migration_vup).addOption("other",r.other),this.settings.customCategories&&this.settings.customCategories.length>0&&(i.addOption("---","--- Custom Categories ---"),this.settings.customCategories.forEach(a=>{i.addOption(a,a)})),i.setValue(this.settings.defaultCategory)}),new m.Setting(t).setName(this.i18nService.t("modal.capture_email.priority")).setDesc("Priority level of this inquiry").addDropdown(i=>{this.priorityDropdown=i;let r=this.i18nService.getTranslationGroup("priorities");i.addOption("low",r.low).addOption("medium",r.medium).addOption("high",r.high).addOption("urgent",r.urgent).setValue(this.settings.defaultPriority)}),new m.Setting(t).setName(this.i18nService.t("modal.capture_email.tags")).setDesc("Comma-separated tags for this email").addText(i=>{this.tagsInput=i,i.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.tags"))}),new m.Setting(t).setName(this.i18nService.t("modal.capture_email.email_content")).setDesc("The main content of the email").addTextArea(i=>{this.bodyInput=i,i.setPlaceholder(this.i18nService.t("modal.capture_email.placeholder.email_content")).inputEl.style.height="200px"});let e=t.createDiv("modal-button-container");e.style.display="flex",e.style.justifyContent="space-between",e.style.marginTop="20px",e.createEl("button",{text:this.i18nService.t("modal.capture_email.cancel_button")},i=>{i.onclick=()=>{this.close()}}),e.createEl("button",{text:this.i18nService.t("modal.capture_email.capture_button"),cls:"mod-cta"},i=>{i.onclick=async()=>{await this.captureEmail()}}),setTimeout(()=>{this.senderInput.inputEl.focus()},100)}onClose(){let{contentEl:t}=this;t.empty()}validateEmail(t){let i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),r=this.senderInput.inputEl;return t&&!i?(r.style.borderColor="red",r.style.boxShadow="0 0 5px rgba(255, 0, 0, 0.3)"):(r.style.borderColor="",r.style.boxShadow=""),i}validateForm(){let t=[],e=this.senderInput.getValue().trim(),i=this.subjectInput.getValue().trim(),r=this.bodyInput.getValue().trim();return e?this.validateEmail(e)||t.push(this.i18nService.t("modal.capture_email.validation.sender_email_invalid")):t.push(this.i18nService.t("modal.capture_email.validation.sender_email_required")),i||t.push(this.i18nService.t("modal.capture_email.validation.subject_required")),r||t.push(this.i18nService.t("modal.capture_email.validation.content_required")),{isValid:t.length===0,errors:t}}async captureEmail(){try{let t=this.validateForm();if(!t.isValid){let s=t.errors.join(`
`);this.showError(`Please fix the following errors:

${s}`);return}let e={sender:this.senderInput.getValue().trim(),senderName:this.senderNameInput.getValue().trim()||void 0,subject:this.subjectInput.getValue().trim(),body:this.bodyInput.getValue().trim(),receivedDate:new Date().toISOString(),category:this.categoryDropdown.getValue()||void 0,priority:this.priorityDropdown.getValue()||"medium",tags:this.parseTags(this.tagsInput.getValue())},i=this.contentEl.querySelector(".mod-cta"),r=i.textContent;i.textContent="Capturing...",i.disabled=!0;let a=await this.emailCaptureService.captureEmail(e);this.onSuccess(a),this.close()}catch(t){this.showError(`Failed to capture email: ${t instanceof Error?t.message:String(t)}`);let e=this.contentEl.querySelector(".mod-cta");e.textContent="Capture Email",e.disabled=!1}}parseTags(t){return t.split(",").map(e=>e.trim()).filter(e=>e.length>0)}showError(t){let e=this.contentEl.querySelector(".modal-error");e&&e.remove();let i=this.contentEl.createDiv("modal-error");i.style.color="red",i.style.backgroundColor="rgba(255, 0, 0, 0.1)",i.style.padding="10px",i.style.marginTop="10px",i.style.borderRadius="4px",i.style.border="1px solid red",i.textContent=t,setTimeout(()=>{i.parentNode&&i.remove()},5e3)}};var c=require("obsidian");var D=class extends c.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty();let e=this.plugin.getI18nService();t.createEl("h2",{text:e.t("settings.title")}),t.createEl("h3",{text:e.t("settings.folders.title")}),new c.Setting(t).setName(e.t("settings.folders.emails_folder")).setDesc(e.t("settings.folders.emails_folder_desc")).addText(a=>a.setPlaceholder("Emails").setValue(this.plugin.settings.emailsFolder).onChange(async s=>{this.plugin.settings.emailsFolder=s||"Emails",await this.plugin.saveSettings()})),new c.Setting(t).setName(e.t("settings.folders.summaries_folder")).setDesc(e.t("settings.folders.summaries_folder_desc")).addText(a=>a.setPlaceholder("Summaries").setValue(this.plugin.settings.summariesFolder).onChange(async s=>{this.plugin.settings.summariesFolder=s||"Summaries",await this.plugin.saveSettings()})),new c.Setting(t).setName(e.t("settings.folders.knowledge_folder")).setDesc(e.t("settings.folders.knowledge_folder_desc")).addText(a=>a.setPlaceholder("Knowledge").setValue(this.plugin.settings.knowledgeFolder).onChange(async s=>{this.plugin.settings.knowledgeFolder=s||"Knowledge",await this.plugin.saveSettings()})),t.createEl("h3",{text:e.t("settings.defaults.title")}),new c.Setting(t).setName(e.t("settings.defaults.category")).setDesc(e.t("settings.defaults.category_desc")).addDropdown(a=>{let s=e.getTranslationGroup("categories");a.addOption("specification",s.specification).addOption("issue",s.issue).addOption("migration_vup",s.migration_vup).addOption("other",s.other),this.plugin.settings.customCategories&&this.plugin.settings.customCategories.length>0&&this.plugin.settings.customCategories.forEach(n=>{a.addOption(n,n)}),a.setValue(this.plugin.settings.defaultCategory).onChange(async n=>{this.plugin.settings.defaultCategory=n,await this.plugin.saveSettings()})}),new c.Setting(t).setName(e.t("settings.defaults.priority")).setDesc(e.t("settings.defaults.priority_desc")).addDropdown(a=>{let s=e.getTranslationGroup("priorities");a.addOption("low",s.low).addOption("medium",s.medium).addOption("high",s.high).addOption("urgent",s.urgent).setValue(this.plugin.settings.defaultPriority).onChange(async n=>{this.plugin.settings.defaultPriority=n,await this.plugin.saveSettings()})}),t.createEl("h3",{text:e.t("settings.automation.title")}),new c.Setting(t).setName(e.t("settings.automation.auto_summary")).setDesc(e.t("settings.automation.auto_summary_desc")).addToggle(a=>a.setValue(this.plugin.settings.autoGenerateSummary).onChange(async s=>{this.plugin.settings.autoGenerateSummary=s,await this.plugin.saveSettings()})),new c.Setting(t).setName(e.t("settings.automation.auto_knowledge")).setDesc(e.t("settings.automation.auto_knowledge_desc")).addToggle(a=>a.setValue(this.plugin.settings.autoExtractKnowledge).onChange(async s=>{this.plugin.settings.autoExtractKnowledge=s,await this.plugin.saveSettings()})),new c.Setting(t).setName(e.t("settings.automation.enable_notifications")).setDesc(e.t("settings.automation.enable_notifications_desc")).addToggle(a=>a.setValue(this.plugin.settings.enableNotifications).onChange(async s=>{this.plugin.settings.enableNotifications=s,await this.plugin.saveSettings()})),t.createEl("h3",{text:e.t("settings.categories.title")});let i=t.createDiv("custom-categories-container");i.style.marginBottom="15px";let r=i.createEl("p",{text:e.t("settings.categories.manage_desc"),cls:"setting-item-description"});r.style.marginBottom="8px",r.style.color="var(--text-muted)",r.style.fontSize="13px",this.displayCustomCategories(i,e),new c.Setting(t).setName(e.t("settings.categories.add_category")).setDesc(e.t("settings.categories.add_category_desc")).addText(a=>{a.setPlaceholder(e.t("settings.categories.category_placeholder"));let s=t.createEl("button",{text:e.t("settings.categories.add_button"),cls:"mod-cta"});s.style.marginLeft="10px",s.onclick=async()=>{let n=a.getValue().trim();n&&!this.plugin.settings.customCategories.includes(n)&&(this.plugin.settings.customCategories.push(n),await this.plugin.saveSettings(),a.setValue(""),this.displayCustomCategories(i,e))},a.inputEl.parentElement?.appendChild(s)}),t.createEl("h3",{text:e.t("settings.advanced.title")}),new c.Setting(t).setName(e.t("settings.advanced.language")).setDesc(e.t("settings.advanced.language_desc")).addDropdown(a=>{let s=e.getTranslationGroup("languages");a.addOption("en",s.en).addOption("ja",s.ja).setValue(this.plugin.settings.language).onChange(async n=>{this.plugin.settings.language=n,await this.plugin.saveSettings(),this.display()})}),new c.Setting(t).setName(e.t("settings.advanced.max_attachment_size")).setDesc(e.t("settings.advanced.max_attachment_size_desc")).addText(a=>a.setPlaceholder("10").setValue(String(this.plugin.settings.maxAttachmentSize/(1024*1024))).onChange(async s=>{let n=parseFloat(s)||10;this.plugin.settings.maxAttachmentSize=n*1024*1024,await this.plugin.saveSettings()})),new c.Setting(t).setName("Reset Settings").setDesc("Reset all settings to default values").addButton(a=>a.setButtonText("Reset to Defaults").setWarning().onClick(async()=>{confirm("Are you sure you want to reset all settings to default values? This cannot be undone.")&&(this.plugin.settings={emailsFolder:"Emails",summariesFolder:"Summaries",knowledgeFolder:"Knowledge",defaultCategory:"specification",defaultPriority:"medium",autoGenerateSummary:!0,autoExtractKnowledge:!1,enableNotifications:!0,maxAttachmentSize:10*1024*1024,language:"en",customCategories:[]},await this.plugin.saveSettings(),this.display())})),t.createEl("h3",{text:"About"}),t.createEl("p",{text:"Email Inquiry Management Plugin v1.0.0 - Capture, organize, and build knowledge from email inquiries."})}displayCustomCategories(t,e){if(t.empty(),this.plugin.settings.customCategories.length===0){t.createEl("p",{text:e.t("settings.categories.no_custom_categories"),cls:"setting-item-description"});return}let i=t.createEl("div",{cls:"custom-categories-list"});i.style.display="flex",i.style.flexWrap="wrap",i.style.gap="8px",i.style.marginTop="8px",this.plugin.settings.customCategories.forEach((r,a)=>{let s=i.createEl("span",{text:r,cls:"category-tag"});s.style.backgroundColor="var(--interactive-accent)",s.style.color="var(--text-on-accent)",s.style.padding="4px 8px",s.style.borderRadius="12px",s.style.fontSize="12px",s.style.display="inline-flex",s.style.alignItems="center",s.style.gap="4px";let n=s.createEl("span",{text:"\xD7",cls:"category-remove"});n.style.cursor="pointer",n.style.fontWeight="bold",n.style.marginLeft="4px",n.style.opacity="0.8",n.style.fontSize="14px",n.style.lineHeight="1",n.style.width="16px",n.style.height="16px",n.style.display="inline-flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.borderRadius="50%",n.style.transition="all 0.2s ease",n.title=e.t("settings.categories.delete_tooltip"),n.addEventListener("mouseenter",()=>{n.style.opacity="1",n.style.backgroundColor="rgba(255, 255, 255, 0.2)",n.style.transform="scale(1.1)"}),n.addEventListener("mouseleave",()=>{n.style.opacity="0.8",n.style.backgroundColor="transparent",n.style.transform="scale(1)"}),n.onclick=async()=>{confirm(e.t("settings.categories.delete_confirm",{category:r}))&&(this.plugin.settings.customCategories.splice(a,1),await this.plugin.saveSettings(),this.displayCustomCategories(t,e))}})}};var H={emailsFolder:"Emails",summariesFolder:"Summaries",knowledgeFolder:"Knowledge",defaultCategory:"specification",defaultPriority:"medium",autoGenerateSummary:!0,autoExtractKnowledge:!1,enableNotifications:!0,maxAttachmentSize:10*1024*1024,language:"en",customCategories:[]},y=class extends h.Plugin{async onload(){console.log("Loading Email Inquiry Plugin"),await this.loadSettings(),this.i18nService=new b,await this.i18nService.initialize(),this.i18nService.setLanguage(this.settings.language),this.vaultAdapter=new _(this.app.vault,this.app.fileManager),this.knowledgeExtractionService=new v(this.vaultAdapter,{knowledgeFolder:this.settings.knowledgeFolder,autoExtractKnowledge:this.settings.autoExtractKnowledge,enableNotifications:this.settings.enableNotifications}),this.dailySummaryService=new E(this.vaultAdapter,{summariesFolder:this.settings.summariesFolder,emailsFolder:this.settings.emailsFolder,language:this.settings.language}),this.emailCaptureService=new p(this.vaultAdapter,this.settings.emailsFolder,void 0,this.knowledgeExtractionService),this.addSettingTab(new D(this.app,this)),this.registerCommands(),this.addRibbonIcon("mail",this.i18nService.t("ribbon.capture_email"),()=>{this.openEmailCaptureModal()}),console.log("[EmailInquiry] Plugin loaded successfully with settings:",{emailsFolder:this.settings.emailsFolder,summariesFolder:this.settings.summariesFolder,knowledgeFolder:this.settings.knowledgeFolder,autoExtractKnowledge:this.settings.autoExtractKnowledge,language:this.settings.language})}onunload(){console.log("Unloading Email Inquiry Plugin")}async loadSettings(){this.settings=Object.assign({},H,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.i18nService&&this.i18nService.setLanguage(this.settings.language),this.vaultAdapter&&(this.knowledgeExtractionService.updateSettings({knowledgeFolder:this.settings.knowledgeFolder,autoExtractKnowledge:this.settings.autoExtractKnowledge,enableNotifications:this.settings.enableNotifications}),this.dailySummaryService.updateSettings({summariesFolder:this.settings.summariesFolder,emailsFolder:this.settings.emailsFolder,language:this.settings.language}),this.emailCaptureService=new p(this.vaultAdapter,this.settings.emailsFolder,void 0,this.knowledgeExtractionService)),console.log("[EmailInquiry] Settings updated:",{emailsFolder:this.settings.emailsFolder,knowledgeFolder:this.settings.knowledgeFolder,autoExtractKnowledge:this.settings.autoExtractKnowledge})}registerCommands(){this.addCommand({id:"capture-email",name:this.i18nService.t("commands.capture_email"),callback:()=>{this.openEmailCaptureModal()}}),this.addCommand({id:"generate-daily-summary",name:this.i18nService.t("commands.generate_daily_summary"),callback:()=>{this.generateDailySummary()}}),this.addCommand({id:"search-knowledge-base",name:this.i18nService.t("commands.search_knowledge_base"),callback:()=>{this.openKnowledgeSearch()}}),this.addCommand({id:"bulk-import-emails",name:this.i18nService.t("commands.bulk_import_emails"),callback:()=>{this.openBulkImportModal()}})}openEmailCaptureModal(){new x(this.app,this.emailCaptureService,this.settings,this.i18nService,t=>{this.settings.enableNotifications&&new h.Notice(this.i18nService.t("notices.email_captured",{path:t.path}))}).open()}async generateDailySummary(){try{let t=new Date().toISOString().split("T")[0];console.log(`[EmailInquiry] Generating daily summary for: ${t}`),new h.Notice(this.i18nService.t("notices.generating_summary",{date:t}));let e=await this.dailySummaryService.generateSummary({date:t,includePreviousDays:0});this.settings.enableNotifications?new h.Notice(this.i18nService.t("notices.summary_generated_with_path",{path:e.filePath,count:e.stats.totalEmails})):new h.Notice(this.i18nService.t("notices.summary_generated")),console.log("[EmailInquiry] Daily summary generated successfully:",e)}catch(t){console.error("[EmailInquiry] Daily summary generation failed:",t),new h.Notice(this.i18nService.t("notices.error_generating_summary",{error:String(t)}))}}openKnowledgeSearch(){new h.Notice(this.i18nService.t("notices.knowledge_search_coming_soon"))}openBulkImportModal(){new h.Notice(this.i18nService.t("notices.bulk_import_coming_soon"))}getEmailsFolder(){return this.settings.emailsFolder}getSummariesFolder(){return this.settings.summariesFolder}getKnowledgeFolder(){return this.settings.knowledgeFolder}getI18nService(){return this.i18nService}};
